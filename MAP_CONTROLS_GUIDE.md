# 🗺️ AI World 地图控制功能指南

## ✅ 新增功能

### 1. 地图拖动 🖱️
**操作方式**：
- 在地图上按住鼠标左键并拖动
- 松开鼠标释放

**视觉反馈**：
- 拖动时光标变为 `grabbing`（抓取状态）
- 静止时光标为 `grab`（可抓取状态）

### 2. 地图缩放 🔍
**操作方式**：
- 鼠标滚轮向上滚动：放大（zoom in）
- 鼠标滚轮向下滚动：缩小（zoom out）

**缩放范围**：
- 最小：0.5x（50%）
- 最大：2.0x（200%）
- 默认：1.0x（100%）

**智能缩放**：
- 以鼠标位置为中心缩放
- 保持鼠标指向的世界坐标不变

### 3. 小地图 🗺️
**位置**：右上角

**显示内容**：
- 🟡 黄色点：资源点
- 🟢 绿色点：智能体
- 🔴 红色框：当前视口位置

**尺寸**：200x140 像素

**功能**：
- 实时显示全局视图
- 帮助定位资源和智能体
- 显示当前查看的区域

### 4. 控制按钮
**🔄 重置视图**：
- 恢复到默认视角
- 缩放重置为 1.0x
- 偏移重置为 (0, 0)

**📍 居中**：
- 将选中的智能体移动到屏幕中心
- 需要先点击智能体选中

---

## 🎮 使用场景

### 场景 1：查找资源点
1. 使用鼠标滚轮**放大**地图
2. **拖动**地图查看不同区域
3. 在**小地图**上看到黄色点（资源）
4. 移动到资源点位置

### 场景 2：追踪智能体
1. 点击智能体选中
2. 点击 **📍 居中** 按钮
3. 智能体移动到屏幕中心
4. 可以放大查看细节

### 场景 3：全局观察
1. 使用鼠标滚轮**缩小**地图
2. 查看整个世界的布局
3. 观察小地图上的分布
4. 规划下一步行动

### 场景 4：迷路了？
1. 点击 **🔄 重置视图** 按钮
2. 回到默认视角
3. 重新开始探索

---

## 🔧 技术细节

### 坐标系统
- **世界坐标**：地图上的实际位置（0-1000, 0-700）
- **屏幕坐标**：Canvas 上的像素位置
- **转换公式**：`screenX = worldX * zoom + offsetX`

### 缩放算法
```typescript
// 以鼠标为中心缩放
const worldX = (mouseX - offsetX) / zoom;
const worldY = (mouseY - offsetY) / zoom;

// 应用新缩放
setOffsetX(mouseX - worldX * newZoom);
setOffsetY(mouseY - worldY * newZoom);
```

### 拖动算法
```typescript
// 记录拖动起点
const dragStart = { x: mouseX - offsetX, y: mouseY - offsetY };

// 更新偏移
setOffsetX(mouseX - dragStart.x);
setOffsetY(mouseY - dragStart.y);
```

---

## 📊 性能优化

### 渲染优化
- 使用 `useCallback` 缓存绘制函数
- 只在状态变化时重新绘制
- 小地图独立渲染

### 动画优化
- 智能体移动动画独立于地图控制
- 使用 `requestAnimationFrame` 平滑动画
- easeOut cubic 缓动函数

---

## 🎯 解决的问题

### 问题：资源点不可见
**原因**：
- 地图 1000x700，但只能看到固定视角
- 资源点可能在视野外
- 无法查看全局

**解决方案**：
- ✅ 拖动查看不同区域
- ✅ 缩放调整视野大小
- ✅ 小地图显示全局
- ✅ 控制按钮快速定位

---

## 🎨 UI 设计

### 视觉反馈
- **拖动**：光标变化（grab → grabbing）
- **缩放**：实时显示缩放比例
- **小地图**：半透明黑色背景
- **视口框**：红色边框

### 颜色方案
- 背景：渐变紫色 (#667eea → #764ba2)
- 主画布：白色框 + 紫色边框
- 小地图：黑色半透明 + 彩色标记
- 按钮：多彩渐变

---

## 🚀 快速开始

### 访问游戏
**URL**: https://ai-world-smoky.vercel.app/?game

### 初始化世界
```javascript
// F12 控制台
await convex.mutation(api.aiworld.init.resetWorld, {})
await convex.mutation(api.aiworld.init.initializeWorld, {})
```

### 创建智能体
```javascript
// 创建几个智能体
await convex.mutation(api.aiworld.mutations.createAgent, {
  name: "探险家",
  personality: "explorer",
  position: { x: 10, y: 7 }
})
```

### 开始探索
1. 点击 "▶️ 开始" 按钮
2. 使用鼠标滚轮缩小地图
3. 拖动地图查看不同区域
4. 观察小地图上的资源分布
5. 点击智能体查看详情
6. 使用 "📍 居中" 跟随智能体

---

## 📝 快捷键（未来计划）

- `Space` + 拖动：平移地图
- `+` / `-`：缩放
- `0`：重置视图
- `F`：跟随选中智能体
- `M`：切换小地图显示

---

## 🐛 已知问题

### 已修复
- ✅ 资源点不显示 → 添加地图控制
- ✅ 智能体不移动 → 实现移动逻辑
- ✅ 位置超出范围 → 修复初始化函数

### 待优化
- ⏳ 添加键盘快捷键
- ⏳ 小地图可点击跳转
- ⏳ 平滑缩放动画
- ⏳ 边界限制（防止拖出地图）

---

## 🎉 总结

现在 AI World 拥有完整的地图控制功能：

- ✅ **拖动地图** - 查看任意区域
- ✅ **缩放功能** - 调整视野大小
- ✅ **小地图** - 全局视图
- ✅ **控制按钮** - 快速定位

**不再有资源点看不见的问题！** 🎊

你可以自由探索整个 AI World，观察智能体的行为，查找资源点，规划策略！

---

**访问**: https://ai-world-smoky.vercel.app/?game

**开始你的探索之旅！** 🌍🗺️✨
